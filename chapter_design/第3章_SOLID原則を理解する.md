# 第3章 ソフトウェア設計で大切なSOLID原則を理解する

## 章の目的
- 設計原則を具体例（コピー機）を通して理解させる
- 各原則（SRP, OCP, LSP, ISP, DIP）をコピー機の部品に対応づけて解説
- 実際のソフトウェア開発への応用方法を示す

## 想定文字数
約5,000〜6,000文字

## 文章構成

### 1. 章の導入（約400文字）
**問いかけ**
「良い設計には、守るべき原則があります。それがSOLID原則です。」

**なぜコピー機で説明するのか**
- 誰もが知っている身近な機械
- 部品の役割が明確で理解しやすい
- ソフトウェアの設計と類似性が高い

**本章の進め方**
- 各原則を一つずつ、コピー機の例で解説
- 原則の本質を理解してから、ソフトウェアへの応用
- 詳細な設計仕様は執筆者向けの「コピー機設計資料」（materials/copy_function.md）を参照し、内容を要約した図や日本語サンプルコードとして読者に提示する

### 2. Single Responsibility Principle（単一責任の原則）（約1,000文字）

#### 2.1 原則の説明（約300文字）
**定義**
「クラスを変更する理由は1つだけであるべき」

**コピー機での例え**
- 読み取り部：原稿を読み取ることだけに責任を持つ
- 印字部：紙に印刷することだけに責任を持つ
- 給紙部：紙を供給することだけに責任を持つ

#### 2.2 なぜ重要か（約350文字）
**責任が混在した場合の問題**
```
悪い例：読み取りと印刷を同じ部品で処理
- 読み取り方式を変更すると印刷も影響を受ける
- テストが複雑になる
- 故障時の原因特定が困難
```

**単一責任のメリット**
- 変更の影響範囲が限定的
- テストが簡単
- 再利用しやすい

#### 2.3 ソフトウェアでの実践（約350文字）
**実例：ユーザー管理システム**
```
良い設計：
- User クラス：ユーザー情報の保持
- UserValidator クラス：入力検証
- UserRepository クラス：データベース操作
- UserNotifier クラス：通知送信

それぞれが単一の責任を持つ
```

**AIとの協調における利点**
- 「UserValidatorに新しい検証ルールを追加して」
- 明確な指示でAIも適切なコードを生成

### 3. Open-Closed Principle（開放閉鎖の原則）（約1,000文字）

#### 3.1 原則の説明（約300文字）
**定義**
「拡張に対しては開いており、修正に対しては閉じているべき」

**コピー機での例え**
- 新しい給紙トレイ（A3サイズ）を追加
- 本体のコードは変更せず、新トレイを登録するだけ
- インターフェースを通じて連携

#### 3.2 実装の仕組み（約400文字）
**コピー機での実現方法**
```
1. 給紙トレイの抽象インターフェース定義
   - 対応用紙サイズの確認
   - 給紙の実行

2. 具体的なトレイの実装
   - A4トレイ
   - A3トレイ
   - カスタムトレイ

3. 本体は抽象インターフェースのみ依存
```

**拡張の容易さ**
- 新しいトレイタイプも同じインターフェースを実装
- 本体側のコード変更は不要

#### 3.3 ソフトウェアでの応用（約300文字）
**実例：支払い処理システム**
```
interface PaymentMethod {
    process(amount: number): Result
}

class CreditCardPayment implements PaymentMethod
class BankTransferPayment implements PaymentMethod
// 新しい決済方法も同じインターフェースで追加
class QRCodePayment implements PaymentMethod
```

### 4. Liskov Substitution Principle（リスコフの置換原則）（約1,000文字）

#### 4.1 原則の説明（約300文字）
**定義**
「派生クラスは基底クラスと置換可能であるべき」

**コピー機での例え**
- どの読み取り部も「読み取る」という基本動作は同じ
- 原稿台スキャナでも自動送りスキャナでも、本体から見れば同じ

#### 4.2 置換可能性の重要性（約400文字）
**正しい置換の例**
```
基本契約：読み取り部
- 入力：読み取り設定
- 出力：画像データ
- 保証：設定通りの解像度で読み取る

原稿台スキャナも自動送りスキャナも
この契約を完全に満たす
```

**間違った置換の例**
- 特定のスキャナだけ異なる形式でデータを返す
- エラー時の動作が異なる
- 本体側で特殊処理が必要になる

#### 4.3 実装時の注意点（約300文字）
**継承を使う際のチェックリスト**
1. 事前条件を強化していないか
2. 事後条件を弱めていないか
3. 不変条件を守っているか
4. 例外の扱いが一貫しているか

### 5. Interface Segregation Principle（インターフェース分離の原則）（約1,000文字）

#### 5.1 原則の説明（約300文字）
**定義**
「クライアントが使わないメソッドに依存すべきでない」

**コピー機での例え**
- 仕上げ機能を細かく分離
- 綴じ機能、折り機能、穴あけ機能を別々のインターフェースに

#### 5.2 なぜ分離が必要か（約400文字）
**問題のある設計**
```
巨大な仕上げインターフェース：
- 綴じる()
- 折る()
- 穴を開ける()

綴じ専用ユニットは折る()と穴を開ける()が不要
→ 空実装や例外を投げる羽目に
```

**適切な分離**
```
interface 綴じ機能 { 綴じる() }
interface 折り機能 { 折る() }
interface 穴あけ機能 { 穴を開ける() }

各ユニットは必要な機能のみ実装
```

#### 5.3 実践的な判断基準（約300文字）
**インターフェースを分割すべきサイン**
- 実装クラスで空メソッドが多い
- 「〜できる」が複数含まれる
- クライアントが一部のメソッドしか使わない

### 6. Dependency Inversion Principle（依存性逆転の原則）（約1,000文字）

#### 6.1 原則の説明（約300文字）
**定義**
「上位モジュールは下位モジュールに依存すべきでない。両者とも抽象に依存すべき」

**コピー機での例え**
- 本体は具体的な「レーザー印字部」を知らない
- 抽象的な「印字部」インターフェースのみ知っている

#### 6.2 依存の方向性（約400文字）
**従来の依存（問題あり）**
```
コピー機本体 → レーザー印字部（具象）
問題：インクジェットに変更したら本体も修正必要
```

**依存性逆転後（正しい）**
```
コピー機本体 → 印字部インターフェース（抽象）
レーザー印字部 → 印字部インターフェース（抽象）
利点：印字方式を変えても本体は無修正
```

#### 6.3 実装のポイント（約300文字）
**依存性注入（DI）の活用**
```
class コピー機本体 {
    constructor(
        private 読取部: 読取部インターフェース,
        private 印字部: 印字部インターフェース
    ) {}
}

// 起動時に具体的な実装を注入
const copier = new コピー機本体(
    new 原稿台スキャナ(),
    new レーザー印字部()
);
```

### 7. SOLID原則の統合（約600文字）
**5つの原則の相互作用**
- SRP：各部品の責任を明確に
- OCP：新機能は追加で対応
- LSP：部品の交換可能性を保証
- ISP：必要な機能だけを公開
- DIP：抽象に依存して柔軟性確保

**コピー機全体での実現**
```
執筆者向け「コピー機設計資料」（materials/copy_function.md）に示す設計をもとに、
これらの原則を組み合わせることで：
- 新しい用紙サイズへの対応が容易
- 印刷方式の変更が本体に影響しない
- 仕上げオプションの追加が簡単
- 各部品のテストが独立して可能
```

**実際のプロジェクトへの適用**
1. まずSRPで責任を整理
2. OCPを意識してインターフェース設計
3. LSPで置換可能性を確保
4. ISPで適切な粒度に分割
5. DIPで依存関係を整理

### 8. 章のまとめ（約400文字）
**学んだこと**
- SOLID原則は相互に関連し、補完し合う
- コピー機のような実例で考えると理解しやすい
- これらの原則は、AIと協調する上でも重要

**AIとSOLID原則**
- 明確な設計はAIへの指示も明確になる
- 原則に従ったコードはAIも理解しやすい
- 拡張時もAIが適切な場所に機能を追加できる

**実践への助言**
- すべての原則を一度に適用しようとしない
- プロジェクトの規模に応じて適用度を調整
- チームで原則の理解を共有することが重要

**詳細な設計資料について**
「本章で紹介したコピー機の詳細な設計仕様、クラス図、シーケンス図は、執筆者用の『コピー機設計資料』（materials/copy_function.md）に整理されています。執筆時は同資料を参考にしてサンプルコードや図解を作成し、読者には要点を噛み砕いた形で紹介してください。」

## 執筆時の注意点

### 説明の工夫
- 抽象的な原則を具体的なコピー機の例で説明
- 原則ごとに「なぜ重要か」を必ず含める
- 実際のコード例は短く、要点を絞る

### バランス
- 理論と実践のバランス
- 理想と現実のバランス
- 各原則の説明量のバランス

### 読者への配慮
- 専門用語は必要最小限に
- 図表の活用（実際の執筆時に追加）
- 段階的な理解を促す構成
